# LogSeq 项目结构文档

## 项目概述
LogSeq 是一个隐私优先的开源知识管理和协作平台。该项目使用 ClojureScript 作为主要开发语言，同时集成了 React 前端框架，支持桌面端（Electron）和移动端（iOS/Android，通过 Capacitor）应用。

## 技术栈
- 主要语言：ClojureScript
- 前端框架：React 17
- 桌面端：Electron
- 移动端：Capacitor
- 样式：TailwindCSS
- 构建工具：Shadow-cljs, Gulp
- 测试框架：Playwright

## 目录结构

### 根目录主要文件
- `package.json` - 项目依赖和脚本配置
- `shadow-cljs.edn` - ClojureScript 编译配置
- `deps.edn` - Clojure 依赖配置
- `gulpfile.js` - Gulp 构建配置
- `tailwind.config.js` - TailwindCSS 配置

### 主要目录
```
src/
├── main/         # 主要源代码
├── test/         # 测试代码
├── resources/    # 资源文件
├── bench/        # 性能测试
├── dev-cljs/     # 开发相关的 ClojureScript 代码
└── electron/     # Electron 相关代码

static/          # 静态资源
public/          # 公共资源
resources/       # 项目资源
packages/        # 子包
libs/            # 库文件
docs/            # 文档
e2e-tests/      # 端到端测试
ios/            # iOS 应用代码
android/        # Android 应用代码
```

## 主要依赖
### 前端相关
- React 17.0.2
- TailwindCSS
- CodeMirror
- KaTeX
- Marked
- PhotoSwipe
- React Grid Layout

### 移动端相关
- Capacitor 核心组件
- 文件系统
- 相机
- 剪贴板
- 后台任务
- 语音录制

### 开发工具
- Shadow-cljs
- Playwright
- Gulp
- PostCSS
- TypeScript

## 构建脚本
项目提供了多个 npm 脚本用于不同场景：
- `yarn watch` - 开发模式监视
- `yarn release` - 构建发布版本
- `yarn test` - 运行测试
- `yarn e2e-test` - 运行端到端测试
- `yarn run-android-release` - 构建并运行 Android 版本
- `yarn run-ios-release` - 构建并运行 iOS 版本

## 开发指南
1. 安装依赖：
   ```bash
   yarn install
   ```

2. 开发模式：
   ```bash
   yarn watch
   ```

3. 构建发布版：
   ```bash
   yarn release
   ```

4. 移动端开发：
   - iOS: `yarn ios:dev`
   - Android: `yarn android:dev`

## 测试
项目使用多种测试方法：
- 单元测试：位于 `src/test/` 目录
- 端到端测试：位于 `e2e-tests/` 目录
- 性能测试：位于 `src/bench/` 目录

## 文档
详细文档可以在以下文件中找到：
- `CONTRIBUTING.md` - 贡献指南
- `CODEBASE_OVERVIEW.md` - 代码库概述
- `docs/` 目录 - 详细文档 

---
- ## Logseq 代码仓库结构介绍
  
  Logseq 是一个开源的知识管理和协作平台，主要使用 ClojureScript 开发，同时结合了现代 Web 技术。以下是对代码仓库结构的详细介绍：  
- ### 技术栈
  
	1. **核心语言：ClojureScript**

	- Logseq 主要使用 ClojureScript（Clojure 编译到 JavaScript）作为主要开发语言
	- ClojureScript 是一种函数式编程语言，具有 Lisp 语法，编译为 JavaScript 运行
	    
		2. **前端框架：React + Rum**

	- 使用 React 作为 UI 库
	- Rum 是 ClojureScript 的 React 包装器，提供了更多 Clojure 风格的状态管理
	    
		3. **数据库：DataScript**

	- 使用 DataScript 作为内存数据库，实现 Datalog 逻辑编程语言
	- 这是 Logseq 的核心技术之一，用于存储和查询文档数据
	    
		4. **构建工具：**

	- Shadow-cljs：用于编译 ClojureScript 代码到 JavaScript
	- Gulp：用于处理静态资源和构建桌面应用
	    
		5. **移动应用支持：**

	- 使用 Capacitor 构建移动应用（iOS 和 Android）
- ### 目录结构
  
	1. **根目录配置文件**

	- `package.json`：JavaScript 依赖
	- `deps.edn`：Clojure 依赖
	- `shadow-cljs.edn`：ClojureScript 编译配置
	- `gulpfile.js`：Gulp 构建脚本
	    
		2. **源代码目录 (`src/`)**

	- `src/main/`：主要应用代码
		- `src/main/frontend/`：编辑器核心代码
		- `src/main/logseq/`：插件 API
		- `src/main/electron/`：桌面应用特定代码
	- `src/electron/`：Electron 相关代码
	- `src/test/`：测试代码
	- `src/dev-cljs/`：开发工具
	- `src/resources/`：Clojure(Script) 使用的资源
	- `src/bench/`：基准测试
	    
		3. **依赖库 (`deps/`)**

	- `deps/graph-parser/`：解析 Logseq 图谱并保存到数据库的库
	- `deps/common/`、`deps/publishing/`、`deps/shui/`：其他内部依赖
	    
		4. **静态资源**

	- `public/`：公共静态资源
	- `resources/`：静态资源
	- `static/`：静态资源
	    
		5. **平台特定代码**

	- `ios/`：iOS 应用代码
	- `android/`：Android 应用代码
- ### Clojure 在项目中的作用
  
  Clojure/ClojureScript 在 Logseq 中扮演着核心角色：  
  
	1. **应用逻辑实现**

	- 整个应用的核心逻辑都是用 ClojureScript 实现的
	- 包括文档解析、数据处理、状态管理等
	    
		2. **数据管理**

	- 使用 DataScript（Clojure 库）作为内存数据库
	- 实现了强大的查询功能，支持用户创建复杂的知识图谱
	    
		3. **UI 渲染**

	- 通过 Rum（ClojureScript 的 React 包装器）实现 UI 组件
	- 使用函数式编程范式构建响应式 UI
	    
		4. **插件系统**

	- 提供 Clojure API 供插件使用，扩展应用功能
- ### 应用架构
  
  Logseq 的应用状态分为两部分：  
	1. 文档相关状态（页面、块和内容）存储在 DataScript 中
	2. UI 相关状态（如当前编辑的块）保存在 Clojure 的 atom 中  
  
当应用启动时：
	1. 从本地或云端加载文件
	2. 解析文件并存储到 DataScript
	3. 初始化 UI 状态
	4. 渲染 React 组件
	5. 注册事件处理程序  
  
当用户在文档中输入内容时：
	1. 调用编辑块的处理程序
	2. 保存工作到磁盘或云端
	3. 更新 UI 状态
	4. 运行事务更新 DataScript 数据库
	5. React 刷新屏幕

- ### 总结
  
  Logseq 是一个使用 ClojureScript 构建的复杂知识管理应用，它充分利用了 Clojure 的函数式编程特性和丰富的生态系统（如 DataScript）。项目结构清晰，分为前端逻辑、数据管理、平台特定代码等多个部分。Clojure 在其中扮演着核心角色，负责实现应用的主要功能和数据处理逻辑。  
  
  这种架构使 Logseq 能够提供强大的知识管理功能，同时保持代码的可维护性和可扩展性。